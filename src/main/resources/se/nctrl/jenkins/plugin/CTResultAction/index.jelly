<!DOCTYPE html>
<?jelly escape-by-default='true'?>
<j:jelly xmlns:j="jelly:core" xmlns:st="jelly:stapler" xmlns:d="jelly:define" xmlns:l="/lib/layout" xmlns:t="/lib/hudson" xmlns:f="/lib/form">


<html>   
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<link href="${HUDSON_CONTEXT_PATH}/plugin/jenkins_ct/bootstrap/css/bootstrap.min.css"  rel="stylesheet" media="screen" />
   <style type="text/css">
      body {
        padding-top: 60px;
        padding-bottom: 40px;
      }
      .sorting {
      
      cursor: pointer;
      }
      .sorting_asc {
      
      cursor: pointer;
      }

      .sorting_desc {
      
      cursor: pointer;
      }

      .dataTables_filter {
    float: right;
    }

    .label-success, .badge-success {
    background-color: #14D100;
    }    

    .label-important, .badge-important {
    background-color: #FF2300;
    }    

    .label-warning, .badge-warning {
    background-color: #FFC200;
    }    

      }
    </style>
<script src="${HUDSON_CONTEXT_PATH}/plugin/jenkins_ct/jquery/jquery-1.8.2.min.js" type="text/javascript" charset="utf-8"></script>
<script src="${HUDSON_CONTEXT_PATH}/plugin/jenkins_ct/datatables/jquery.dataTables.min.js" type="text/javascript" charset="utf-8"></script>
<script src="${HUDSON_CONTEXT_PATH}/plugin/jenkins_ct/g.raphael/raphael-min.js" type="text/javascript" charset="utf-8"></script>
<script src="${HUDSON_CONTEXT_PATH}/plugin/jenkins_ct/g.raphael/g.raphael-min.js" type="text/javascript" charset="utf-8"></script>
<script src="${HUDSON_CONTEXT_PATH}/plugin/jenkins_ct/g.raphael/g.bar-min.js" type="text/javascript" charset="utf-8"></script>
<script src="${HUDSON_CONTEXT_PATH}/plugin/jenkins_ct/g.raphael/g.dot-min.js" type="text/javascript" charset="utf-8"></script>
<script src="${HUDSON_CONTEXT_PATH}/plugin/jenkins_ct/g.raphael/g.line-min.js" type="text/javascript" charset="utf-8"></script>
<script src="${HUDSON_CONTEXT_PATH}/plugin/jenkins_ct/g.raphael/g.line-min.js" type="text/javascript" charset="utf-8"></script>
<script src="${HUDSON_CONTEXT_PATH}/plugin/jenkins_ct/g.raphael/g.pie-min.js" type="text/javascript" charset="utf-8"></script>


<script type="text/javascript">
                var num_passed = ${it.passCount};
                var num_failed = ${it.failCount};
                var num_skipped = ${it.skipCount};
</script>

<script type="text/javascript">

<![CDATA[

$(document).ready(function () {
                

function filterGlobal (str)
{
  
      
      for (var  i = 0;i < $('.dataTable').size(); i++)
      {
        
        $("#dt_"+i).dataTable().fnFilter(
          str,
          null,
          true,
          true
      );
    }
}


                var r = Raphael("result_chart",380,250);
                var passed_col = "#14D100";
                var failed_col = "#FFC200";
                var skipped_col = "#FF2300";

               
                pie = r.piechart(125, 125, 100, 
                        [num_passed,num_failed,num_skipped],
                        { 
                          colors: [passed_col,failed_col,skipped_col], 
                          strokewidth: "3",
                          legend: ["Passed", "Failed", "Skipped"],
                          legendpos: "east"
                        }
                        );
                


                $('.table').dataTable( { 
                  "iDisplayLength" : 50,
                  "sDom" : "<'row-fluid'<'span6'T><'span6'<'control-group'<'controls'f>>>r>t<'row-fluid'<'span6'i><'span6 pull-right'p>>",
                  "aaSorting": [[2,'asc']]
                });
                $('.dataTables_wrapper').removeClass("form-inline");
                $('.dataTables_filter > label').contents().filter(function() { return this.nodeType == 3; }).remove(); // Remove label text
                $('.dataTables_filter > label > input').unwrap();
                $('.dataTables_filter').addClass("input-prepend");
                $('.dataTables_filter > input').before("<span class='add-on'><i class='icon-filter'></i></span>");
                $('.dataTables_filter > input').attr('id','inputIcon').attr('placeholder','filter').addClass("span8");

                // Global filter
                $('#gfilter_all > a').bind('click',function(event){ event.preventDefault(); $("[id^=gfilter]").removeClass("active");$('#gfilter_all').addClass("active"); filterGlobal("")});
                $('#gfilter_failed > a').bind('click',function(event){ event.preventDefault(); $("[id^=gfilter]").removeClass("active");$('#gfilter_failed').addClass("active");  filterGlobal("Failed")});
                $('#gfilter_passed > a').bind('click',function(event){ event.preventDefault();$("[id^=gfilter]").removeClass("active");$('#gfilter_passed').addClass("active");  filterGlobal("Passed")});
                $('#gfilter_skipped > a').bind('click',function(event){ event.preventDefault();$("[id^=gfilter]").removeClass("active");$('#gfilter_skipped').addClass("active"); filterGlobal("Skipped")});


                // Navbar
                $("#nav-back").click(function() { history.back(); return false; });

                // Show sorting order in table headers
                $("th[class^=sorting]").bind('click',function(event)
                  {
                      var up = "icon-arrow-up";
                      var down = "icon-arrow-down"
                      var i = $(event.target).children('i');

                      
                      $(i).toggleClass(up,$(event.target).hasClass("sorting_asc")).toggleClass(down,$(event.target).hasClass("sorting_desc"));
                      $("th[class=sorting] > i").toggleClass(up,false).toggleClass(down,false);
                  } 
                  );


 ]]>
                });
</script>
                
    

<script src="${HUDSON_CONTEXT_PATH}/plugin/jenkins_ct/datatables/dataTables.bootstrap.js" type="text/javascript" charset="utf-8"></script>

</head>
 <body>

    <div class="navbar navbar-inverse navbar-fixed-top">
      <div class="navbar-inner">
        <div class="container">
          <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </a>
          <a class="brand" href="#">CT Results</a>
          <div class="nav-collapse collapse">
            <ul class="nav">
              <li><a href="#" id="nav-back"><i class="icon-chevron-left icon-white"></i> Go back</a></li>
              <!--
              <li><a href="#">Project</a></li>
              <li><a href="#">Export</a></li>
               -->              
            </ul>

          </div><!--/.nav-collapse -->
        </div>
      </div>
    </div>

    <div class="container">

      <!-- Summary -->
      <div class="well small">
        
        <div class="row">
            <div class="span5">
            <div id="result_chart"></div>
          </div>
          <div class="span5">
          <p class="lead"><h3>Test results, summary</h3>
          <hr />
          <dl class="dl-horizontal">
          <dt>Number of suites</dt>
          <dd>${it.result.children.size()}</dd>
          <dt>Number of test cases</dt>
          <dd>${it.totalCount}</dd>
          <dt>Passed test cases</dt>
          <dd>${it.passCount}</dd>
          <dt>Failed test cases</dt>
          <dd>${it.failCount}</dd>
          <dt>Skipped test cases</dt>
          <dd>${it.skipCount}</dd>
          </dl>
          </p>
          </div>

        </div>
      </div>
      <!-- Summary -->

      <!-- Content -->
      <div class="navbar">
  <div class="navbar-inner">
    <a class="brand" href="#">Filter</a>
    <ul class="nav">
      <li class="active" id="gfilter_all"><a href="#">Show all</a></li>
      <li id="gfilter_passed"><a href="#" >Only Passed</a></li>
      <li id="gfilter_failed"><a href="#" >Only Failed</a></li>
      <li id="gfilter_skipped"><a href="#">Only Skipped</a></li>
    </ul>
  </div>
</div>




      <j:set var="s_num" value="0" />
      <j:forEach var="suites" items="${it.result.children}">
        


      <div class="row">
        <div class="span12">
          <p class="lead">${suites.displayName}<br />
          <j:if test="${suites.passCount != 0}">
          <span class="badge badge-success">${suites.passCount}</span>
          </j:if>
          <j:if test="${suites.failCount != 0}">
          &#160;<span class="badge badge-important">${suites.failCount}</span>
          </j:if>
          <j:if test="${suites.skipCount != 0}">
          &#160;<span class="badge badge-warning">${suites.skipCount}</span></j:if></p>
          
          <hr />

         <table class="table table-striped" id="dt_${s_num}">
  
  <thead>
    <tr>
      <th>Result <i class="icon-empty"></i></th>
      <th>Test case <i class="icon-empty"></i></th>
      <th>Started <i class="icon-empty icon-arrow-up"></i></th>
    </tr>
  </thead>
  <tbody>

<!-- cases -->
        <j:forEach var="cases" items="${suites.children}">
    <tr>
      <td>
          <j:if test="${cases.result == 0}">
          <span class="label label-important">Failed</span>
          </j:if>
          <j:if test="${cases.result == 1}">
          <span class="label label-success">Passed</span>
          </j:if>
          <j:if test="${cases.result == 2}">
          <span class="label label-warning">Skipped</span>
          </j:if>

      </td>
      <td>${cases.displayName}</td>
      <td>${cases.started.toString()}</td>
    </tr>
        </j:forEach>
<!-- cases -->

  </tbody>
</table> 
        </div>
      </div>
      <!-- Content -->

          <j:set var="s_num" value="${s_num + 1}" />
      </j:forEach> <!-- suites -->

      <hr />

      <footer>
        <p>Company 2012</p>
      </footer>

    </div> <!-- container -->

</body></html>

      
</j:jelly>